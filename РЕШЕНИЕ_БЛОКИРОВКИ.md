# Быстрое решение: Не удаляется папка products

## Если папка `products` не удаляется после закрытия программы:

### Метод 1: Подождите (САМОЕ ВАЖНОЕ)
```
1. Закройте приложение TankManager
2. Подождите 5-10 секунд ??
3. Попробуйте удалить папку снова
```

**Почему:** Windows нужно время, чтобы освободить файловые дескрипторы после принудительной сборки мусора.

---

### Метод 2: Проверьте процесс
```
1. Ctrl + Shift + Esc (Диспетчер задач)
2. Найдите процесс "TankManager.exe"
3. Если есть - завершите принудительно
4. Попробуйте удалить папку
```

---

### Метод 3: Перезапустите Проводник
```
1. Ctrl + Shift + Esc (Диспетчер задач)
2. Найдите "Проводник" (Windows Explorer)
3. ПКМ ? Перезапустить
4. Попробуйте удалить папку
```

---

### Метод 4: Используйте командную строку
```
1. Win + R
2. Введите: cmd
3. Введите команды:
   cd "C:\путь\к\папке\с\программой"
   timeout /t 5 /nobreak
   rmdir /s /q products
```

---

### Метод 5: Process Explorer (для программистов)
Скачайте [Process Explorer](https://docs.microsoft.com/en-us/sysinternals/downloads/process-explorer)
```
1. Запустите Process Explorer от имени администратора
2. Ctrl + F ? введите "products"
3. Найдите процесс, держащий дескриптор
4. Закройте процесс или дескриптор
```

---

### Метод 6: Unlocker (если ничего не помогло)
Скачайте [Unlocker](https://www.iobit.com/en/iobit-unlocker.php)
```
1. Установите Unlocker
2. ПКМ на папке products ? Unlocker
3. Выберите "Delete" ? OK
```

---

### Метод 7: Безопасный режим (крайний случай)
```
1. Перезагрузите компьютер
2. При загрузке нажмите F8
3. Выберите "Безопасный режим"
4. Удалите папку
5. Перезагрузите нормально
```

---

## Профилактика

### Правильная последовательность работы:
1. Работайте с программой
2. **ЗАКРОЙТЕ** все открытые превью чертежей
3. **ЗАКРОЙТЕ** главное окно программы (не убивайте через Task Manager)
4. **ПОДОЖДИТЕ 5-10 секунд** ??
5. Удаляйте папку

---

## Диагностика (для разработчиков)

### Найти, какой процесс держит файл:
```cmd
handle.exe "C:\путь\к\products" /accepteula
```

### Проверить открытые дескрипторы в Process Explorer:
```
1. Process Explorer ? Find ? Handle or DLL
2. Введите "products" или имя конкретного файла
3. Найдите процесс
```

### Вывод отладочной информации:
```
После закрытия программы откройте Output window в Visual Studio:
View ? Output ? выберите "Debug"
Посмотрите сообщения с эмодзи:
??? - попытка удаления
? - успешно
? - ошибка
?? - предупреждение
```

---

## Если проблема продолжается

**Напишите в Issues на GitHub:**
1. Версия Windows
2. Шаги для воспроизведения
3. Логи из Output window (Debug)
4. Результат команды `handle.exe`

---

## Технические причины блокировки

| Компонент | Что блокирует | Решение |
|-----------|---------------|---------|
| BitmapImage | PNG превью чертежей | Загрузка через MemoryStream |
| DataContractJsonSerializer | JSON файлы продуктов | Чтение/запись через MemoryStream |
| ShellFile | Thumbnail превью файлов КОМПАС | Dispose() после использования |
| FileStream | Любые файлы | FileShare.Read + освобождение в using |
| Проводник Windows | Кэш thumbnails | Перезапуск проводника |

---

## Контакты
- GitHub Issues: https://github.com/Bezdus/TankManager/issues
- Email: [ваш email]

**ВАЖНО:** Всегда ждите 5-10 секунд после закрытия программы! ??
